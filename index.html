<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 4: Choose Your Lens</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .font-serif { font-family: 'Playfair Display', serif; }
        
        .step-content { display: none; }
        .step-content.active { display: block; animation: fadeIn 0.6s ease-out forwards; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Print Optimization */
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
            .print-container { box-shadow: none !important; border: none !important; width: 100% !important; max-width: 100% !important; margin: 0 !important; }
            .bg-stone-900 { background-color: #1c1917 !important; color: white !important; -webkit-print-color-adjust: exact; }
            .bg-stone-50 { background-color: #f9f8f6 !important; -webkit-print-color-adjust: exact; }
            .text-white { color: black !important; } 
            .print-black-text { color: black !important; }
            textarea { border: 1px solid #ccc; }
        }
    </style>
</head>
<body class="bg-[#faf9f6] text-slate-900 p-4 md:p-8 min-h-screen flex items-center justify-center">

    <div id="main-card" class="print-container max-w-5xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden border border-stone-100 flex flex-col">
        
        <!-- Header -->
        <header class="p-6 md:p-10 border-b border-stone-50 flex justify-between items-center bg-white sticky top-0 z-20">
            <div>
                <h1 class="text-2xl font-serif font-bold tracking-tight">The Lens Principle</h1>
                <p class="text-[10px] text-stone-400 uppercase tracking-[0.3em] mt-1">Just 10 Minutes with Pen and Paper</p>
            </div>
            <div class="hidden md:flex items-center gap-4 no-print">
                <span class="text-[10px] font-black uppercase tracking-widest text-stone-300">Phase</span>
                <div id="header-dots" class="flex gap-1">
                    <!-- Dots injected by JS -->
                </div>
            </div>
        </header>

        <!-- Content Area -->
        <main id="worksheet-content" class="p-6 md:p-12 flex-grow min-h-[600px] flex flex-col justify-between">
            
            <!-- Step 0: Intro -->
            <section id="step-0" class="step-content active">
                <div class="text-center space-y-8 max-w-2xl mx-auto py-12">
                    <div class="relative inline-block">
                        <div class="w-24 h-24 bg-stone-900 text-white rounded-3xl flex items-center justify-center mx-auto transform rotate-6">
                            <i data-lucide="aperture" class="w-10 h-10"></i>
                        </div>
                    </div>
                    <h2 class="text-5xl font-serif font-medium tracking-tight">Journaling is not a performance.</h2>
                    <p class="text-xl text-stone-500 leading-relaxed font-light">
                        It is a tool. And like any tool, it must fit the task. You don't need a better personality; you need the right lens for your current state of mind.
                    </p>
                    <div class="pt-6">
                        <button type="button" onclick="nextStep()" class="group px-10 py-5 bg-black text-white rounded-full font-medium hover:bg-stone-800 transition-all flex items-center gap-3 mx-auto shadow-xl hover:shadow-2xl">
                            Find My Lens <i data-lucide="chevron-right" class="w-5 h-5 group-hover:translate-x-1 transition-transform"></i>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Step 1: Energy State (The Lens) -->
            <section id="step-1" class="step-content">
                <div class="space-y-8">
                    <div class="text-center max-w-xl mx-auto">
                        <h2 class="text-3xl font-serif mb-3">Check Your Energy</h2>
                        <p class="text-stone-400">Different mental states require different lenses. How does your mind feel <em>right now</em>?</p>
                    </div>
                    <div id="mood-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Injected by JS -->
                    </div>
                </div>
            </section>

            <!-- Step 2: Goal -->
            <section id="step-2" class="step-content">
                <div class="space-y-8 max-w-2xl mx-auto">
                    <div class="text-center">
                        <h2 class="text-3xl font-serif mb-3">What do you need most?</h2>
                        <p class="text-stone-400">The goal determines the method.</p>
                    </div>
                    <div id="goal-grid" class="grid grid-cols-1 gap-4">
                        <!-- Injected by JS -->
                    </div>
                </div>
            </section>

            <!-- Step 3: Content/Input -->
            <section id="step-3" class="step-content">
                <div class="space-y-8">
                    <div class="text-center">
                        <h2 class="text-3xl font-serif mb-3">Current Mental Load</h2>
                        <p class="text-stone-400">What is taking up space in your head?</p>
                    </div>
                    <div id="load-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <!-- Injected by JS -->
                    </div>
                    <div class="flex justify-center pt-8">
                        <button type="button" onclick="nextStep()" class="px-12 py-4 bg-black text-white rounded-full font-bold shadow-xl transition-all hover:bg-stone-800">
                            Continue
                        </button>
                    </div>
                </div>
            </section>

            <!-- Step 4: Refine -->
            <section id="step-4" class="step-content">
                <div class="space-y-8 max-w-xl mx-auto">
                    <div class="text-center">
                        <h2 class="text-3xl font-serif mb-3">Focusing the Lens</h2>
                        <p class="text-stone-400">Confirm your intention for today.</p>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-[10px] font-black uppercase tracking-[0.2em] mb-3 text-stone-400">If your journal could speak back, what would it say?</label>
                            <textarea id="style-goal" class="w-full p-6 rounded-2xl border-2 border-stone-100 focus:border-black outline-none bg-stone-50 min-h-[120px] text-lg font-light italic" placeholder="e.g., Slow down, Organize this mess, Just let it out..."></textarea>
                        </div>
                    </div>
                    <button type="button" onclick="generateResult()" class="w-full py-5 bg-black text-white rounded-2xl font-bold shadow-2xl hover:bg-stone-800 transition-all">
                        Reveal My Lens
                    </button>
                </div>
            </section>

            <!-- Result -->
            <section id="result-step" class="step-content">
                <div id="result-container" class="animate-in">
                    <!-- Result content will be generated here -->
                </div>
                <div class="mt-12 flex flex-wrap justify-center gap-4 no-print">
                    <button onclick="window.print()" class="flex items-center gap-3 px-8 py-4 bg-white border-2 border-stone-200 rounded-full font-bold hover:border-black transition-all">
                        <i data-lucide="download" class="w-5 h-5"></i> Save This Lens
                    </button>
                    <button onclick="resetWorksheet()" class="flex items-center gap-3 px-8 py-4 bg-stone-100 rounded-full font-bold hover:bg-stone-200 transition-all">
                        <i data-lucide="rotate-ccw" class="w-5 h-5"></i> Choose New Lens
                    </button>
                </div>
            </section>

            <!-- Navigation Bar (Shared) -->
            <div id="nav-bar" class="flex justify-between items-center mt-12 pt-8 border-t border-stone-100 no-print hidden">
                <button type="button" onclick="prevStep()" class="flex items-center gap-2 text-stone-400 hover:text-black font-bold text-sm uppercase tracking-widest transition-all">
                    <i data-lucide="chevron-left" class="w-4 h-4"></i> Back
                </button>
                <div id="progress-text" class="text-sm font-bold">0%</div>
            </div>
        </main>

        <!-- Brand Footer -->
        <footer class="bg-stone-50 px-10 py-8 flex flex-col md:flex-row justify-between items-center border-t border-stone-100">
            <div class="flex items-center gap-6 mb-4 md:mb-0 no-print">
                <div class="text-[10px] font-black text-stone-400 uppercase tracking-widest">Share</div>
                <div class="flex gap-3">
                    <div class="w-8 h-8 rounded-full bg-white border border-stone-200 flex items-center justify-center cursor-pointer hover:bg-black hover:text-white transition-all"><i data-lucide="instagram" class="w-3 h-3"></i></div>
                    <div class="w-8 h-8 rounded-full bg-white border border-stone-200 flex items-center justify-center cursor-pointer hover:bg-black hover:text-white transition-all"><i data-lucide="twitter" class="w-3 h-3"></i></div>
                </div>
            </div>
            <div class="text-[10px] font-black text-stone-300 uppercase tracking-widest">
                Based on Chapter 4: Choose Your Lens
            </div>
        </footer>
    </div>

    <script>
        // Data Structures - Strictly aligned with Chapter 4
        const ARCHETYPES = {
            'Architect': {
                title: "The Architect",
                subtitle: "Clarity Through Structure",
                energy: "Overloaded. Busy. Pressured.",
                goal: "Order. Prioritization. Mental Space.",
                description: "The Architect does not write paragraphs; the Architect builds structure. Instead of explaining everything in detail, you extract the essentials. This lens is not cold; it is stabilizing.",
                challenge: {
                    title: "The Extraction Method",
                    desc: "Don't write sentences. List: <br>1. Stress level (1-10)<br>2. Trigger (What happened)<br>3. Emotion (One word)<br>4. Action (One step)<br>Use this to close the open tabs in your mind."
                }
            },
            'Storyteller': {
                title: "The Storyteller",
                subtitle: "Release Through Flow",
                energy: "Restless. Anxious. Mentally Noisy.",
                goal: "Emotional Processing. Internal Relief.",
                description: "The Storyteller writes without interruption. No editing. No correcting. When thoughts stay in the mind, they recycle. When they hit paper, they slow down.",
                challenge: {
                    title: "The Unfiltered Flow",
                    desc: "Set a timer for 10 minutes. Write exactly what you are thinking, even if it is 'I don't know what to write.' Do not lift your pen. You are not solving the storm; you are letting it pass through."
                }
            },
            'Artist': {
                title: "The Artist",
                subtitle: "Expression Beyond Words",
                energy: "Wordless. Creative. Emotionally Stuck.",
                goal: "Expression. Symbolic Insight.",
                description: "Sometimes you don't need sentences. You need symbols. A single symbol can hold what paragraphs struggle to explain. This is not art class; this is translation.",
                challenge: {
                    title: "The Symbolic Translation",
                    desc: "Draw a battery for your energy. Draw a cloud for your heaviness. Draw a stick figure climbing something steep. It does not need to be beautiful. It needs to be honest."
                }
            }
        };

        // Step 1: Energy (The Diagnostic)
        const MOODS = [
            { title: 'Overloaded & Busy', id: 'Architect', icon: 'layers', desc: 'My mind feels like fifty open tabs.' },
            { title: 'Restless & Anxious', id: 'Storyteller', icon: 'wind', desc: 'My thoughts are racing and recycling.' },
            { title: 'Wordless & Stuck', id: 'Artist', icon: 'image', desc: 'I feel something but cannot name it.' }
        ];

        // Step 2: Goal
        const GOALS = [
            { id: 'Architect', label: 'Order & Prioritization', desc: 'I need to organize the chaos.' },
            { id: 'Storyteller', label: 'Relief & Release', desc: 'I need to get this off my chest.' },
            { id: 'Artist', label: 'Expression & Insight', desc: 'I need to see what I am feeling.' }
        ];

        // Step 3: Load
        const LOADS = ['Work Pressure', 'Unresolved Conflict', 'Vague Anxiety', 'Too Many Tasks', 'Creative Block', 'Physical Exhaustion', 'Future Worry', 'Overthinking'];

        // State Management
        let currentStep = 0;
        let formData = {
            archetypeId: '', 
            goalPreference: '',
            load: [],
            userGoal: ''
        };

        // Initialize UI
        function init() {
            renderGrids();
            updateStep();
            lucide.createIcons();
        }

        function renderGrids() {
            // Mood Grid 
            const moodGrid = document.getElementById('mood-grid');
            moodGrid.innerHTML = MOODS.map(m => `
                <button type="button" onclick="selectArchetype('${m.id}')" class="mood-btn p-8 rounded-3xl border-2 text-left transition-all hover:scale-[1.02] border-stone-100 hover:border-stone-300 bg-white group h-full flex flex-col justify-between w-full" data-val="${m.id}">
                    <div>
                        <div class="w-14 h-14 rounded-2xl mb-6 flex items-center justify-center bg-stone-50 btn-icon-container transition-colors">
                            <i data-lucide="${m.icon}" class="w-6 h-6"></i>
                        </div>
                        <h3 class="font-serif font-bold text-2xl mb-3 leading-tight">${m.title}</h3>
                    </div>
                    <p class="text-sm text-stone-500 leading-relaxed">${m.desc}</p>
                </button>
            `).join('');

            // Goal Grid
            const goalGrid = document.getElementById('goal-grid');
            goalGrid.innerHTML = GOALS.map(g => `
                <button type="button" onclick="selectGoal('${g.id}')" class="goal-btn flex items-center justify-between p-6 rounded-2xl border-2 transition-all border-stone-100 hover:border-stone-200 bg-white w-full" data-val="${g.id}">
                    <div class="text-left">
                        <p class="font-bold text-lg">${g.label}</p>
                        <p class="text-sm text-stone-500">${g.desc}</p>
                    </div>
                    <i data-lucide="target" class="text-stone-300 w-5 h-5"></i>
                </button>
            `).join('');

            // Load Grid
            const loadGrid = document.getElementById('load-grid');
            loadGrid.innerHTML = LOADS.map(l => `
                <button type="button" onclick="toggleLoad('${l}')" class="load-btn p-4 rounded-2xl border-2 text-sm font-semibold transition-all border-stone-100 hover:border-stone-300 bg-white w-full" data-val="${l}">
                    ${l}
                </button>
            `).join('');
        }

        // Logic Functions
        function selectArchetype(val) {
            formData.archetypeId = val;
            document.querySelectorAll('.mood-btn').forEach(b => {
                b.classList.remove('border-black', 'bg-stone-50');
                b.querySelector('.btn-icon-container').classList.remove('bg-black', 'text-white', 'bg-stone-50');
                b.querySelector('.btn-icon-container').classList.add('bg-stone-50');
                
                if(b.dataset.val === val) {
                    b.classList.add('border-black', 'bg-stone-50');
                    b.querySelector('.btn-icon-container').classList.remove('bg-stone-50');
                    b.querySelector('.btn-icon-container').classList.add('bg-black', 'text-white');
                }
            });
            setTimeout(nextStep, 350);
        }

        function selectGoal(val) {
            formData.goalPreference = val;
            document.querySelectorAll('.goal-btn').forEach(b => {
                b.classList.toggle('border-black', b.dataset.val === val);
                b.classList.toggle('bg-stone-50', b.dataset.val === val);
            });
            setTimeout(nextStep, 300);
        }

        function toggleLoad(val) {
            if(formData.load.includes(val)) {
                formData.load = formData.load.filter(i => i !== val);
            } else {
                formData.load.push(val);
            }
            document.querySelectorAll('.load-btn').forEach(b => {
                const isActive = formData.load.includes(b.dataset.val);
                b.classList.toggle('bg-black', isActive);
                b.classList.toggle('text-white', isActive);
                b.classList.toggle('border-black', isActive);
            });
        }

        function nextStep() {
            if (currentStep < 5) {
                currentStep++;
                updateStep();
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                currentStep--;
                updateStep();
            }
        }

        function updateStep() {
            // Hide all steps first
            const steps = document.querySelectorAll('.step-content');
            steps.forEach(el => el.classList.remove('active'));
            
            // Show current step if exists
            if (steps[currentStep]) {
                steps[currentStep].classList.add('active');
            }

            const nav = document.getElementById('nav-bar');
            // Hide nav on Intro (0) and Result (5)
            if (currentStep === 0 || currentStep === 5) {
                nav.classList.add('hidden');
            } else {
                nav.classList.remove('hidden');
            }

            const prog = document.getElementById('progress-text');
            // Calculate progress based on 4 active input steps (1-4)
            let percentage = 0;
            if (currentStep > 0 && currentStep < 5) {
                percentage = Math.round(((currentStep) / 4) * 100);
            } else if (currentStep === 5) {
                percentage = 100;
            }
            prog.innerText = percentage + '%';
            
            // Update dots
            const dots = document.getElementById('header-dots');
            dots.innerHTML = [0,1,2,3,4,5].map(i => {
                if (i === 0) return ''; // Skip intro dot
                if (i === 5) return ''; // Skip result dot
                return `<div class="w-2 h-2 rounded-full ${i <= currentStep ? 'bg-black' : 'bg-stone-200'}"></div>`
            }).join('');

            lucide.createIcons();
        }

        function generateResult() {
            formData.userGoal = document.getElementById('style-goal').value;
            const res = ARCHETYPES[formData.archetypeId] || ARCHETYPES['Architect'];
            
            const container = document.getElementById('result-container');
            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <div class="lg:col-span-7 bg-stone-50 rounded-[2.5rem] p-10 md:p-14 border border-stone-100 relative overflow-hidden flex flex-col">
                        <div class="absolute top-0 right-0 p-10 opacity-[0.03] scale-150"><i data-lucide="aperture" class="w-64 h-64"></i></div>
                        <div class="relative z-10 space-y-8 h-full flex flex-col">
                            <div>
                                <div class="inline-flex items-center gap-3 px-4 py-2 bg-white rounded-full text-[10px] font-black uppercase tracking-widest border border-stone-200 mb-6">
                                    <i data-lucide="check-circle-2" class="w-4 h-4 text-green-500"></i> Your Current Lens
                                </div>
                                <h2 class="text-6xl font-serif font-medium leading-tight tracking-tighter mb-2">${res.title}</h2>
                                <p class="text-lg font-bold text-stone-400 uppercase tracking-widest mb-6">${res.subtitle}</p>
                                
                                <p class="text-xl text-stone-600 leading-relaxed font-light mb-4">${res.description}</p>
                                
                                <div class="bg-white/50 p-6 rounded-2xl border border-stone-200/50">
                                    <div class="grid grid-cols-2 gap-6">
                                        <div>
                                            <p class="text-[10px] font-black uppercase tracking-widest text-stone-400 mb-2">Energy State</p>
                                            <p class="font-bold text-stone-800">${res.energy}</p>
                                        </div>
                                        <div>
                                            <p class="text-[10px] font-black uppercase tracking-widest text-stone-400 mb-2">Target Goal</p>
                                            <p class="font-bold text-stone-800">${res.goal}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <p class="text-xs text-stone-400 italic mt-6">*Disclaimer: You do not need to choose this lens forever. You only need to choose it for today.</p>
                            </div>
                            
                            <div class="mt-auto pt-8">
                                <div class="bg-white/60 p-5 rounded-2xl border border-stone-100 backdrop-blur-sm">
                                    <div class="flex items-start gap-3">
                                        <i data-lucide="lightbulb" class="w-5 h-5 text-amber-500 mt-1"></i>
                                        <div>
                                            <p class="text-[10px] font-black uppercase tracking-widest text-stone-400 mb-1">Fun Fact (Chapter 4)</p>
                                            <p class="text-sm text-stone-600 font-medium">Leonardo da Vinci, Thomas Edison, and Einstein all used "Visual Journaling." Doodling actually improves memory retention by 29%.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-5 space-y-6">
                        
                        <!-- The 10-Minute Challenge Card -->
                        <div class="bg-black text-white p-8 rounded-[2rem] space-y-4 shadow-xl print-black-text">
                            <div class="flex items-center gap-2 text-amber-400">
                                <i data-lucide="timer" class="w-5 h-5"></i>
                                <h4 class="text-[10px] font-black uppercase tracking-widest">10-Minute Method</h4>
                            </div>
                            <h3 class="text-2xl font-serif font-bold text-white print-black-text">${res.challenge.title}</h3>
                            <p class="text-stone-300 leading-relaxed print-black-text">${res.challenge.desc}</p>
                        </div>

                        <!-- Post-Journaling Reflection (NEW) -->
                        <div class="bg-white p-8 rounded-[2rem] space-y-4 border border-stone-100">
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-stone-500">Post-Journaling Reflection</h4>
                            <p class="text-sm text-stone-600">After your 10 minutes, ask yourself:</p>
                            <div class="bg-stone-50 p-4 rounded-xl">
                                <p class="font-serif italic text-lg text-stone-800 mb-2">"How did my energy shift?"</p>
                                <textarea class="w-full bg-transparent border-b border-stone-200 focus:border-black outline-none h-16 text-sm resize-none" placeholder="Write a brief note here..."></textarea>
                            </div>
                        </div>

                        <div class="bg-amber-50 p-8 rounded-[2rem] border border-amber-100 space-y-4">
                            <div class="flex items-center gap-2 text-amber-800">
                                <i data-lucide="book-open" class="w-4 h-4"></i>
                                <h4 class="text-[10px] font-black uppercase tracking-widest">Chapter Insight</h4>
                            </div>
                            <p class="text-amber-900 leading-relaxed font-medium italic">"A camera lens does not change the world. It changes how the world is captured. The page should adapt to youâ€”not the other way around."</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Set current step to 5 (Result Index)
            currentStep = 5;
            updateStep();
            lucide.createIcons();
        }

        function resetWorksheet() {
            formData = { archetypeId: '', goalPreference: '', load: [], userGoal: '' };
            currentStep = 0;
            document.getElementById('style-goal').value = '';
            renderGrids();
            updateStep();
        }

        // Wait for DOM
        window.onload = init;
    </script>
</body>
</html>
